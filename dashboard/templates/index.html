<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stampede Shield - Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="dark">

    <!-- HEADER -->
    <header class="header">
        <div class="header-left">
            <span class="logo">üö® STAMPEDE SHIELD</span>
        </div>
        <div class="header-center">
            <span class="live-indicator" id="liveIndicator">
                <span class="live-dot"></span>
                <span id="modeLabel">LIVE</span>
            </span>
            <!-- Simulation Mode Selector -->
            <select id="simModeSelect" class="sim-mode-select" title="Data Source">
                <option value="live">üü¢ Live Data</option>
                <option value="normal">üîµ Sim: Normal</option>
                <option value="medium">üü° Sim: Medium</option>
                <option value="surge">üî¥ Sim: Surge</option>
            </select>
        </div>
        <div class="header-right">
            <button class="calibrate-btn" onclick="calibrateSystem()">‚öôÔ∏è Calibrate</button>
            <span class="timestamp">Last Update: <span id="timestamp">--:--:--</span></span>
            <button class="theme-toggle" id="themeToggle" title="Toggle Theme">üåô</button>
            <button class="fullscreen-btn" id="fullscreenBtn" title="Fullscreen">‚õ∂</button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main-container">

        <!-- LEFT PANEL -->
        <aside class="left-panel">

            <!-- RISK CARD -->
            <div class="card risk-card" id="riskCard">
                <div class="card-header">RISK LEVEL</div>
                <div class="card-body">
                    <div class="risk-emoji" id="riskEmoji">üü¢</div>
                    <div class="risk-level" id="riskLevel">SAFE</div>
                    <div class="risk-score"><span id="riskScore">0</span>%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="riskProgress"></div>
                    </div>
                    <div class="confidence-row">
                        <span>Confidence:</span>
                        <span id="riskConfidence">0</span>%
                        <div class="mini-progress">
                            <div class="mini-progress-fill" id="riskConfidenceBar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CPI CARD -->
            <div class="card cpi-card">
                <div class="card-header">CROWD PRESSURE INDEX</div>
                <div class="card-body">
                    <div class="cpi-value" id="cpiValue">0.0</div>
                    <div class="confidence-row">
                        <span>Confidence:</span>
                        <span id="cpiConfidence">0</span>%
                        <div class="mini-progress">
                            <div class="mini-progress-fill" id="cpiConfidenceBar"></div>
                        </div>
                    </div>
                    <div class="cpi-breakdown">
                        <div class="cpi-item">
                            <span>Density</span>
                            <div class="cpi-bar">
                                <div class="cpi-bar-fill" id="densityBar"></div>
                            </div>
                            <span id="densityValue">0%</span>
                        </div>
                        <div class="cpi-item">
                            <span>Motion</span>
                            <div class="cpi-bar">
                                <div class="cpi-bar-fill" id="motionBar"></div>
                            </div>
                            <span id="motionValue">0%</span>
                        </div>
                        <div class="cpi-item">
                            <span>Audio</span>
                            <div class="cpi-bar">
                                <div class="cpi-bar-fill" id="audioBar"></div>
                            </div>
                            <span id="audioValue">0%</span>
                        </div>
                        <div class="cpi-item">
                            <span>Trend</span>
                            <div class="cpi-bar">
                                <div class="cpi-bar-fill" id="trendBar"></div>
                            </div>
                            <span id="trendValue">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TIME TO CRITICAL -->
            <div class="card time-card">
                <div class="card-header">TIME TO CRITICAL</div>
                <div class="card-body">
                    <div class="time-value">‚è±Ô∏è <span id="timeToCritical">--</span></div>
                    <div class="time-label">Until CRITICAL level</div>
                </div>
            </div>

            <!-- NODE STATUS -->
            <div class="card node-card">
                <div class="card-header">NODE STATUS</div>
                <div class="card-body">
                    <div class="node-item">
                        <span class="node-indicator" id="nodeAStatus">üî¥</span>
                        <span>NODE_A (Entry)</span>
                    </div>
                    <div class="node-item">
                        <span class="node-indicator" id="nodeBStatus">üî¥</span>
                        <span>NODE_B (Exit)</span>
                    </div>
                    <div class="node-item">
                        <span class="node-indicator" id="nodeCStatus">üî¥</span>
                        <span>NODE_C (Center)</span>
                    </div>
                </div>
            </div>

        </aside>

        <!-- RIGHT CONTENT -->
        <section class="right-content">

            <!-- CORRIDOR HEATMAP -->
            <div class="card heatmap-card">
                <div class="card-header">CORRIDOR MAP</div>
                <div class="card-body">
                    <div class="corridor">
                        <div class="zone" id="entryZone">
                            <div class="zone-label">ENTRY</div>
                            <div class="zone-detection" id="entryDetection">--</div>
                            <div class="zone-distance"><span id="entryDist">--</span> cm</div>
                            <div class="zone-density"><span id="entryDensity">--</span>/m¬≤</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="zone" id="centerZone">
                            <div class="zone-label">CENTER</div>
                            <div class="zone-detection" id="centerDetection">--</div>
                            <div class="zone-distance"><span id="centerDist">--</span> cm</div>
                            <div class="zone-density"><span id="centerDensity">--</span>/m¬≤</div>
                        </div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="zone" id="exitZone">
                            <div class="zone-label">EXIT</div>
                            <div class="zone-detection" id="exitDetection">--</div>
                            <div class="zone-distance"><span id="exitDist">--</span> cm</div>
                            <div class="zone-density"><span id="exitDensity">--</span>/m¬≤</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PREDICTIVE TIMELINE -->
            <div class="card timeline-card">
                <div class="card-header">PREDICTED RISK (Next 2 Minutes)</div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-label">NOW</div>
                            <div class="timeline-box" id="timelineNow">--</div>
                        </div>
                        <div class="timeline-arrow">‚Üí</div>
                        <div class="timeline-item">
                            <div class="timeline-label">+30s</div>
                            <div class="timeline-box" id="timeline30">--</div>
                        </div>
                        <div class="timeline-arrow">‚Üí</div>
                        <div class="timeline-item">
                            <div class="timeline-label">+60s</div>
                            <div class="timeline-box" id="timeline60">--</div>
                        </div>
                        <div class="timeline-arrow">‚Üí</div>
                        <div class="timeline-item">
                            <div class="timeline-label">+120s</div>
                            <div class="timeline-box" id="timeline120">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AUDIO MONITOR -->
            <div class="card audio-card">
                <div class="card-header">üé§ AUDIO MONITOR</div>
                <div class="card-body">
                    <div class="audio-level">
                        <span>Level: <span id="audioLevel">0</span></span>
                        <span class="audio-state" id="audioState">Normal</span>
                    </div>
                    <div class="audio-bar">
                        <div class="audio-bar-fill" id="audioBarFill"></div>
                    </div>
                    <div class="audio-thresholds">
                        <span>Normal</span>
                        <span>Loud</span>
                        <span>Scream</span>
                    </div>
                </div>
            </div>

            <!-- AUDIO ACTIVITY GRAPH -->
            <div class="card audio-graph-card">
                <div class="card-header">üìä AUDIO ACTIVITY (Last 2 Minutes)</div>
                <div class="card-body">
                    <div class="audio-graph-container">
                        <canvas id="audioGraph"></canvas>
                    </div>
                </div>
            </div>

            <!-- RECOMMENDED ACTIONS -->
            <div class="card actions-card">
                <div class="card-header">RECOMMENDED ACTIONS</div>
                <div class="card-body">
                    <div class="actions-list" id="actionsList">
                        <div class="action-item">
                            <span class="action-priority">1Ô∏è‚É£</span>
                            <div class="action-content">
                                <div class="action-text">Continue Monitoring</div>
                                <div class="action-reason">No immediate action required</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RISK FACTORS -->
            <div class="card factors-card">
                <div class="card-header">RISK FACTORS</div>
                <div class="card-body">
                    <ul class="factors-list" id="factorsList">
                        <li>‚úÖ No major risk factors</li>
                    </ul>
                </div>
            </div>

        </section>

    </main>

    <!-- ALERT BAR -->
    <footer class="alert-bar" id="alertBar">
        <span id="recommendation">‚úÖ Normal. Continue monitoring.</span>
    </footer>

    <!-- AUDIO ALERT -->
    <audio id="alertSound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
    </audio>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>